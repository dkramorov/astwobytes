{% extends "skeleton.html" %}
{% load flatcontent_tags mtags %}

{% block extrahead %}
<style type="text/css">
.resp-vtabs .resp-tabs-container {
  margin-left: 10px;
}
.resp-tab-active {
  border-color: #ff3d1f !important;
  color: #ff3d1f;
}
h2.resp-tab-active span.resp-arrow {
  border-bottom: 12px solid #ff3d1f;
}
</style>
{% endblock %}

{% block content %}
<div class="container">
  <div class="row">
    <div id="tabs-profile">
      <ul class="resp-tabs-list">
        <li><i class="fa fa-dashboard"></i> Ваш аккаунт</li>
        <li><i class="fa fa-cart-arrow-down"></i> Заказы</li>
        <li><i class="fa fa-cloud-download"></i> Документы</li>
        <li><i class="fa fa-credit-card"></i> Способоы оплаты</li>
        <li><i class="fa fa-map-marker"></i> Адрес доставки</li>
        <li><i class="fa fa-user"></i> Личные данные</li>
        <li data="1" id="logout_tab"><i class="fa fa-sign-out"></i> Выход</li>
    </ul> 
    <div class="resp-tabs-container">                                                     
      <div class="tab_content">
        <h3>Ваш аккаунт</h3>
        <div class="welcome">
          <p>Добро пожаловать, <strong>{{ shopper.name }}</strong> в ваш личный кабинет</p>
        </div>
        <p class="mb-0">Здесь можно посмотреть ваши заказы, получить документы по заказам, увидеть личную скидку, изменить информацию о себе, способах оплаты и доставки</p>
      </div>
      <div class="tab_content">
        <h3>Заказы</h3>
        <div class="myaccount-table table-responsive text-center">
          <table class="table table-bordered">
            <thead class="thead-light">
              <tr>
                <th>№</th>
                <th>Наименование</th>
                <th>Дата</th>
                <th>Статус</th>
                <th>Итого</th>
                <th>Действия</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders %}
                <tr>
                  <td>{{ order.id }}</td>
                  <td>{{ order.shopper_name }}</td>
                  <td>{{ order.created|date:'d-m-Y H:i:s' }}</td>
                  <td>Оформлен</td>
                  <td>{{ order.total|money_format }} ₽</td>
                  <td><a target="_blank" href="/shop/order/{{ order.id }}/" class="btn">Посмотреть</a></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="tab_content">
        <h3>Документы</h3>
        <div class="myaccount-table table-responsive text-center">
          <table class="table table-bordered">
            <thead class="thead-light">
              <tr>
                <th>Заказ</th>
                <th>Дата</th>
                <th>Данные</th>
                <th>Загрузить</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <div class="tab_content">
        <h3>Способы оплаты</h3>
        <p class="saved-message">У вас нет сохраненных способов оплаты</p>
      </div>
      <div class="tab_content">
        <h3>Адрес доставки</h3>
        <address>
          <p><strong>{{ shopper.name }}</strong></p>
          <p>{% if shopper.address %}{{ shopper.address }}<br>{% endif %}</p>
          <p>Тел: {% if shopper.phone %}{{ shopper.phone }}{% endif %}</p>
        </address>
        <a><i class="fa fa-edit"></i>Изменить</a>
      </div>
      <div class="tab_content">
        <h3>Ваш профиль</h3>
        <div class="account-details-form">
          <form action="{% url 'main:show_profile' %}" method="post" id="profile_form">
            {% csrf_token %}
            <fieldset>
              <div class="form-group">
                <label>Как к вам обращаться? <span class="required"></span></label>
                <input placeholder="Как к вам обращаться?" type="text" name="name" data-msg="Как к вам обращаться?" value="{% if shopper.name %}{{ shopper.name }}{% endif %}" class="form-control required">
              </div>
              <div class="form-group">
                <label>Ваше имя <span class="required"></span></label>
                <input placeholder="Ваше имя" type="text" name="first_name" data-msg="Ваше имя" value="{% if shopper.first_name %}{{ shopper.first_name }}{% endif %}" class="form-control required">
              </div>
              <div class="form-group">
                <label>Ваша фамилия <span class="required"></span></label>
                <input placeholder="Ваша фамилия" type="text" name="last_name" data-msg="Ваша фамилия" value="{% if shopper.last_name %}{{ shopper.last_name }}{% endif %}" class="form-control required">
              </div>
              <div class="form-group">
                <label>Ваше отчество</label>
                <input placeholder="Ваше отчество" type="text" name="middle_name" data-msg="Ваше отчество" value="{% if shopper.middle_name %}{{ shopper.middle_name }}{% endif %}" class="form-control">
              </div>
              <div class="form-group">
                <label>Ваш Email</label>
                <input placeholder="Ваш Email" type="text" name="email" data-msg="Ваш Email" value="{% if shopper.email %}{{ shopper.email }}{% endif %}" class="form-control email">
              </div>
              <div class="form-group">
                <label>Ваш телефон <span class="required"></span></label>
                <input placeholder="Ваш телефон" type="text" name="phone" data-msg="Ваш телефон" value="{% if shopper.phone %}{{ shopper.phone }}{% endif %}" class="form-control required phone">
              </div>
              <div class="form-group">
                <label>Адрес доставки</label>
                <input placeholder="Адрес для доставки" type="text" name="address" data-msg="Адрес для доставки" value="{% if shopper.address %}{{ shopper.address }}{% endif %}" class="form-control">
              </div>
              <div class="form-group"><h4>Изменение пароля</h4></div>
              <div class="form-group">
                <label>Текущий пароль</label>
                <input placeholder="Текущий пароль" type="password" name="passwd" class="form-control">
              </div>
              <div class="form-group">
                <label>Новый пароль</label>
                <input placeholder="Новый пароль" type="password" name="passwd1" class="form-control">
              </div>
              <div class="form-group">
                <label>Повторите новый пароль</label>
                <input placeholder="Повторите новый пароль" type="password" name="passwd2" class="form-control">
              </div>
              <div class="form-group feedback_alerts"></div>
              <div class="form-group">
                <button title="Сохранить" class="button orange" type="submit">
                  <span><span>Сохранить</span></span>
                </button>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
      <div class="tab_content"><a href="{% url 'main:logout' %}">Выход</a></div>
    </div>
  </div>
</div>

{% for container in page.containers %}
  {% flatcontent request page container.container.tag %}
{% endfor %}
{% endblock %}

{% block extrascripts %}
<script src="/static/js/jquery.form.min.js"></script>
<script src="/static/js/jquery.validate.min.js"></script>
<script src="/static/js/jquery.maskedinput.min.js"></script>
<script src="/static/js/feedback.js"></script>
<script src="/media/js/easyResponsiveTabs.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    var profile = new FeedBack("profile_form", {
      "wait": "Ждите...",
      //"send": "Отправить",
      "success": "Профиль обновлен",
      "progress": "Пожалуйста, ждите...",
      "error": "Произошла ошибка, сообщите нам по телефону",
      "error_captcha": "Не пройдена проверка на работа",
      "callback_success": "",
      "callback_error": "",
      "dont_reset_on_submit": 1, // or 1
      //"errorClass": "invalid",
    });

    $('#tabs-profile').easyResponsiveTabs({
      type: 'vertical', //Types: default, vertical, accordion
      width: 'auto', //auto or any width like 600px
      fit: true,   // 100% fit in a container
      closed: 'accordion', // Start closed if in accordion view
      activate: function(event) {
        console.log('actived', event, $(this).attr('id'));
        if ($(this).attr('id') === 'logout_tab') {
          window.location.href = "{% url 'main:logout' %}";
        }
      }
    });

  });
</script>
{% endblock %}