#-*- coding:utf-8 -*-
import os
import json
import logging

from lxml import html, etree

from django.core.management.base import BaseCommand
from django.conf import settings

from apps.main_functions.files import ListDir
from apps.main_functions.catcher import json_pretty_print

logger = logging.getLogger(__name__)

"""
Пересохранение svg файла с pretty_print
и дополнительными параметрами
Использовался для построение этажей для 3д карты

В файлах должно идти все по порядку - от первого блока
до последнего, если в файле порядок будет перепутан,
то работать будет некорректно (то есть, рисуем так,
чтобы в файле все шло по порядку)
"""

svg_files = {
    'A-R18.svg': {
        'path': 'A-R18.svg',
        'name': 'Секция A, диски R18',
        'code': 'A-R18',
        'label': 'A',
        'i': 63, # width
        'j': 9, # height
        'color': '#b7a6bd',
        'show': 'false',
        'type': 'wheel',
        'direction': 'ltr',
        'coords': [
            [0.9808,0.6559], [0.9664,0.6547], [0.9524,0.6547], [0.9394,0.6547], [0.9244,0.6553], [0.9114,0.6559], [0.8981,0.6559], [0.8848,0.6553], [0.8718,0.6553], [0.8574,0.6553], [0.8438,0.6559], [0.8301,0.6564], [0.8174,0.6559], [0.8044,0.6553], [0.7894,0.6559], [0.7764,0.6564], [0.7618,0.6564], [0.7498,0.6559], [0.7355,0.6567], [0.7222,0.6567], [0.7082,0.6561], [0.6942,0.6545], [0.6815,0.6556], [0.6669,0.6550], [0.6535,0.6561], [0.6392,0.6561], [0.6265,0.6561], [0.6129,0.6556], [0.5992,0.6556], [0.5845,0.6556],[0.5722,0.6560], [0.5586,0.6565], [0.5436,0.6571], [0.5309,0.6560], [0.5172,0.6554], [0.5039,0.6548], [0.4912,0.6565], [0.4769,0.6554], [0.4639,0.6548], [0.4492,0.6560], [0.4359,0.6560], [0.4225,0.6559], [0.4095,0.6554], [0.3945,0.6543], [0.3809,0.6548], [0.3675,0.6565], [0.3542,0.6554], [0.3422,0.6548], [0.3279,0.6554], [0.3139,0.6559], [0.3002,0.6548], [0.2872,0.6554], [0.2729,0.6559], [0.2585,0.6559], [0.2465,0.6548], [0.2321,0.6568], [0.2185,0.6563], [0.2045,0.6568], [0.1915,0.6568], [0.1781,0.6574], [0.1648,0.6557], [0.1505,0.6568], [0.1378,0.6568],
            [0.9808,0.6237], [0.9678,0.6237], [0.9528,0.6232], [0.9398,0.6232], [0.9264,0.6237], [0.9128,0.6226], [0.8984,0.6220], [0.8844,0.6220], [0.8721,0.6220], [0.8584,0.6232], [0.8438,0.6220], [0.8308,0.6220], [0.8158,0.6220], [0.8031,0.6215], [0.7898,0.6215], [0.7764,0.6232], [0.7638,0.6232], [0.7488,0.6226], [0.7355,0.6228], [0.7221,0.6233], [0.7095,0.6233], [0.6945,0.6228], [0.6808,0.6228], [0.6688,0.6239], [0.6538,0.6233], [0.6408,0.6228], [0.6281,0.6228], [0.6135,0.6228], [0.5991,0.6228], [0.5851,0.6239], [0.5708,0.6228], [0.5591,0.6217], [0.5455,0.6228], [0.5315,0.6233], [0.5181,0.6233], [0.5048,0.6228], [0.4910,0.6238], [0.4776,0.6238], [0.4643,0.6231], [0.4506,0.6224], [0.4364,0.6224], [0.4226,0.6211], [0.4097,0.6224], [0.3968,0.6231], [0.3835,0.6224], [0.3676,0.6224], [0.3543,0.6224], [0.3414,0.6224], [0.3276,0.6231], [0.3164,0.6231], [0.3011,0.6241], [0.2864,0.6230], [0.2717,0.6225], [0.2607,0.6236], [0.2451,0.6241], [0.2311,0.6241], [0.2181,0.6236], [0.2074,0.6230], [0.1915,0.6240], [0.1785,0.6229], [0.1635,0.6234], [0.1512,0.6234], [0.1378,0.6229],
            [0.9801,0.5912], [0.9661,0.5906], [0.9534,0.5906], [0.9404,0.5895], [0.9248,0.5884], [0.9128,0.5895], [0.8988,0.5895], [0.8848,0.5895], [0.8704,0.5906], [0.8578,0.5901], [0.8454,0.5895], [0.8308,0.5895], [0.8174,0.5895], [0.8021,0.5901], [0.7891,0.5906], [0.7761,0.5895], [0.7618,0.5890], [0.7501,0.5895], [0.7356,0.5904], [0.7220,0.5887], [0.7073,0.5881], [0.6943,0.5881], [0.6816,0.5887], [0.6666,0.5887], [0.6533,0.5887], [0.6400,0.5893], [0.6260,0.5893], [0.6123,0.5887], [0.6000,0.5893], [0.5850,0.5909], [0.5720,0.5904], [0.5576,0.5887], [0.5456,0.5887], [0.5314,0.5896], [0.5184,0.5896], [0.5047,0.5903], [0.4897,0.5889], [0.4772,0.5896], [0.4634,0.5896], [0.4501,0.5889], [0.4368,0.5896], [0.4226,0.5882], [0.4089,0.5889], [0.3951,0.5882], [0.3809,0.5889], [0.3684,0.5889], [0.3555,0.5889], [0.3409,0.5896], [0.3272,0.5896], [0.3143,0.5889], [0.2997,0.5889], [0.2884,0.5903], [0.2722,0.5903], [0.2597,0.5896], [0.2455,0.5889], [0.2322,0.5889], [0.2180,0.5882], [0.2055,0.5889], [0.1918,0.5909], [0.1776,0.5889], [0.1651,0.5896], [0.1509,0.5896], [0.1372,0.5896],
            [0.9804,0.5564], [0.9674,0.5564], [0.9544,0.5559], [0.9391,0.5564], [0.9261,0.5564], [0.9114,0.5547], [0.8988,0.5553], [0.8858,0.5570], [0.8721,0.5559], [0.8584,0.5553], [0.8448,0.5553], [0.8298,0.5559], [0.8168,0.5559], [0.8028,0.5559], [0.7901,0.5559], [0.7764,0.5559], [0.7618,0.5559], [0.7488,0.5553], [0.7368,0.5564], [0.7218,0.5559], [0.7091,0.5570], [0.6958,0.5559], [0.6808,0.5559], [0.6674,0.5564], [0.6544,0.5564], [0.6401,0.5559], [0.6248,0.5559], [0.6141,0.5559], [0.5988,0.5559], [0.5864,0.5564], [0.5728,0.5564], [0.5608,0.5564], [0.5444,0.5559], [0.5318,0.5564], [0.5184,0.5564], [0.5045,0.5564], [0.4908,0.5559], [0.4768,0.5559], [0.4638,0.5564], [0.4498,0.5559], [0.4375,0.5564], [0.4235,0.5564], [0.4098,0.5570], [0.3958,0.5564], [0.3821,0.5564], [0.3705,0.5564], [0.3548,0.5559], [0.3418,0.5553], [0.3278,0.5559], [0.3141,0.5553], [0.2991,0.5570], [0.2858,0.5570], [0.2738,0.5564], [0.2591,0.5559], [0.2464,0.5559], [0.2324,0.5564], [0.2194,0.5559], [0.2051,0.5564], [0.1918,0.5559], [0.1778,0.5559], [0.1651,0.5559], [0.1514,0.5559], [0.1368,0.5553],
            [0.9801,0.5239], [0.9661,0.5216], [0.9534,0.5228], [0.9394,0.5228], [0.9254,0.5216], [0.9134,0.5228], [0.8981,0.5222], [0.8864,0.5222], [0.8718,0.5222], [0.8578,0.5222], [0.8438,0.5228], [0.8301,0.5228], [0.8158,0.5222], [0.8028,0.5228], [0.7904,0.5233], [0.7761,0.5228], [0.7638,0.5228], [0.7501,0.5222], [0.7351,0.5222], [0.7221,0.5222], [0.7074,0.5216], [0.6948,0.5211], [0.6808,0.5216], [0.6661,0.5222], [0.6548,0.5222], [0.6391,0.5222], [0.6261,0.5216], [0.6124,0.5228], [0.5994,0.5228], [0.5854,0.5228], [0.5721,0.5222], [0.5581,0.5216], [0.5438,0.5222], [0.5308,0.5216], [0.5178,0.5216], [0.5031,0.5222], [0.4905,0.5216], [0.4765,0.5216], [0.4625,0.5211], [0.4495,0.5216], [0.4368,0.5222], [0.4225,0.5216], [0.4095,0.5211], [0.3961,0.5222], [0.3825,0.5216], [0.3675,0.5244], [0.3548,0.5228], [0.3421,0.5228], [0.3271,0.5222], [0.3141,0.5228], [0.2998,0.5222], [0.2858,0.5233], [0.2735,0.5233], [0.2608,0.5228], [0.2465,0.5222], [0.2315,0.5222], [0.2188,0.5228], [0.2051,0.5222], [0.1918,0.5228], [0.1785,0.5194], [0.1642,0.5228], [0.1508,0.5228], [0.1367,0.5228],
            [0.9818,0.4899], [0.9678,0.4905], [0.9521,0.4910], [0.9388,0.4916], [0.9258,0.4905], [0.9128,0.4894], [0.8991,0.4905], [0.8851,0.4905], [0.8721,0.4899], [0.8571,0.4905], [0.8454,0.4899], [0.8311,0.4905], [0.8158,0.4899], [0.8031,0.4905], [0.7894,0.4905], [0.7771,0.4921], [0.7634,0.4905], [0.7504,0.4905], [0.7348,0.4905], [0.7218,0.4905], [0.7081,0.4921], [0.6951,0.4916], [0.6808,0.4910], [0.6688,0.4905], [0.6544,0.4910], [0.6401,0.4905], [0.6264,0.4905], [0.6131,0.4899], [0.5994,0.4905], [0.5864,0.4899], [0.5728,0.4899], [0.5581,0.4899], [0.5448,0.4905], [0.5321,0.4905], [0.5181,0.4905], [0.5048,0.4905], [0.4888,0.4905], [0.4768,0.4899], [0.4628,0.4894], [0.4495,0.4899], [0.4371,0.4899], [0.4235,0.4899], [0.4091,0.4905], [0.3961,0.4899], [0.3811,0.4899], [0.3691,0.4894], [0.3561,0.4894], [0.3415,0.4899], [0.3275,0.4905], [0.3141,0.4910], [0.3008,0.4894], [0.2871,0.4899], [0.2728,0.4905], [0.2598,0.4894], [0.2455,0.4910], [0.2338,0.4905], [0.2176,0.4889], [0.2050,0.4895], [0.1900,0.4900], [0.1779,0.4902], [0.1632,0.4902], [0.1505,0.4902], [0.1369,0.4908],
            [0.9808,0.4568], [0.9671,0.4579], [0.9531,0.4579], [0.9401,0.4574], [0.9271,0.4574], [0.9124,0.4568], [0.8971,0.4557], [0.8841,0.4562], [0.8728,0.4574], [0.8578,0.4568], [0.8444,0.4574], [0.8311,0.4579], [0.8168,0.4579], [0.8041,0.4574], [0.7894,0.4568], [0.7758,0.4568], [0.7631,0.4568], [0.7501,0.4568], [0.7358,0.4557], [0.7228,0.4562], [0.7091,0.4568], [0.6948,0.4562], [0.6808,0.4568], [0.6674,0.4568], [0.6541,0.4568], [0.6411,0.4568], [0.6251,0.4574], [0.6118,0.4579], [0.5991,0.4562], [0.5858,0.4574], [0.5721,0.4574], [0.5578,0.4562], [0.5451,0.4574], [0.5315,0.4574], [0.5181,0.4579], [0.5048,0.4574], [0.4905,0.4568], [0.4775,0.4562], [0.4625,0.4574], [0.4498,0.4579], [0.4361,0.4574], [0.4241,0.4574], [0.4085,0.4568], [0.3958,0.4574], [0.3825,0.4579], [0.3691,0.4574], [0.3551,0.4574], [0.3421,0.4574], [0.3278,0.4574], [0.3141,0.4574], [0.3008,0.4574], [0.2868,0.4562], [0.2745,0.4568], [0.2605,0.4568], [0.2461,0.4568], [0.2328,0.4568], [0.2181,0.4568], [0.2075,0.4574], [0.1914,0.4555], [0.1789,0.4573], [0.1640,0.4567], [0.1508,0.4567], [0.1376,0.4561],
            [0.9811,0.4252], [0.9664,0.4252], [0.9541,0.4230], [0.9394,0.4230], [0.9254,0.4230], [0.9118,0.4230], [0.8991,0.4230], [0.8854,0.4241], [0.8731,0.4241], [0.8578,0.4236], [0.8431,0.4247], [0.8318,0.4241], [0.8168,0.4241], [0.8041,0.4241], [0.7904,0.4241], [0.7774,0.4236], [0.7624,0.4230], [0.7484,0.4236], [0.7354,0.4236], [0.7218,0.4230], [0.7088,0.4247], [0.6954,0.4247], [0.6814,0.4247], [0.6678,0.4241], [0.6544,0.4236], [0.6398,0.4224], [0.6268,0.4230], [0.6144,0.4241], [0.5998,0.4241], [0.5864,0.4230], [0.5731,0.4241], [0.5571,0.4241], [0.5448,0.4236], [0.5321,0.4241], [0.5184,0.4236], [0.5028,0.4236], [0.4925,0.4236], [0.4785,0.4236], [0.4635,0.4241], [0.4491,0.4236], [0.4371,0.4236], [0.4228,0.4252], [0.4068,0.4241], [0.3961,0.4236], [0.3825,0.4230], [0.3698,0.4230], [0.3561,0.4241], [0.3421,0.4236], [0.3285,0.4236], [0.3138,0.4236], [0.3001,0.4247], [0.2881,0.4241], [0.2748,0.4269], [0.2605,0.4247], [0.2468,0.4241], [0.2321,0.4241], [0.2198,0.4241], [0.2048,0.4224], [0.1911,0.4241], [0.1781,0.4236], [0.1651,0.4236], [0.1505,0.4236], [0.1381,0.4241],
            [0.9804,0.3906], [0.9678,0.3901], [0.9531,0.3895], [0.9398,0.3901], [0.9261,0.3901], [0.9128,0.3901], [0.8988,0.3890], [0.8858,0.3912], [0.8718,0.3906], [0.8581,0.3901], [0.8434,0.3901], [0.8308,0.3895], [0.8164,0.3901], [0.8038,0.3906], [0.7908,0.3901], [0.7754,0.3901], [0.7631,0.3895], [0.7488,0.3906], [0.7351,0.3901], [0.7211,0.3890], [0.7088,0.3906], [0.6944,0.3906], [0.6818,0.3901], [0.6684,0.3912], [0.6534,0.3901], [0.6404,0.3895], [0.6268,0.3895], [0.6134,0.3906], [0.5994,0.3895], [0.5851,0.3901], [0.5721,0.3901], [0.5588,0.3895], [0.5445,0.3917], [0.5318,0.3912], [0.5185,0.3901], [0.5045,0.3890], [0.4905,0.3895], [0.4781,0.3895], [0.4621,0.3906], [0.4498,0.3906], [0.4368,0.3901], [0.4221,0.3901], [0.4075,0.3901], [0.3945,0.3895], [0.3825,0.3901], [0.3705,0.3901], [0.3545,0.3906], [0.3431,0.3906], [0.3288,0.3901], [0.3151,0.3901], [0.3015,0.3901], [0.2888,0.3906], [0.2728,0.3895], [0.2611,0.3901], [0.2465,0.3901], [0.2335,0.3901], [0.2198,0.3906], [0.2058,0.3906], [0.1931,0.3901], [0.1774,0.3906], [0.1641,0.3912], [0.1504,0.3912], [0.1378,0.3906],
        ],
    },
    'B-R17.svg': {
        'path': 'B-R17.svg',
        'name': 'Секция B, диски R17',
        'code': 'B-R17',
        'label': 'B',
        'i': 56, # width
        'j': 9, # height
        'color': '#b7a6bd',
        'show': 'false',
        'type': 'wheel',
        'direction': 'ltr',
        'coords': [
            [0.9738,0.6934], [0.9564,0.6951], [0.9391,0.6951], [0.9218,0.6928], [0.9048,0.6928], [0.8874,0.6917], [0.8694,0.6934], [0.8534,0.6928], [0.8348,0.6940], [0.8191,0.6940], [0.8008,0.6934], [0.7841,0.6945], [0.7648,0.6934], [0.7484,0.6934], [0.7314,0.6923], [0.7144,0.6934], [0.6981,0.6934], [0.6794,0.6928], [0.6624,0.6934], [0.6448,0.6940], [0.6278,0.6945], [0.6101,0.6940], [0.5928,0.6934], [0.5768,0.6934], [0.5578,0.6928], [0.5398,0.6923], [0.5238,0.6928], [0.5071,0.6934], [0.4891,0.6945], [0.4704,0.6928], [0.4541,0.6934], [0.4348,0.6945], [0.4185,0.6945], [0.4001,0.6940], [0.3851,0.6945], [0.3688,0.6945], [0.3481,0.6934], [0.3318,0.6923], [0.3158,0.6940], [0.2975,0.6940], [0.2805,0.6940], [0.2631,0.6945], [0.2458,0.6945], [0.2278,0.6928], [0.2118,0.6928], [0.1941,0.6934], [0.1768,0.6934], [0.1584,0.6923], [0.1408,0.6934], [0.1238,0.6945], [0.1064,0.6940], [0.0888,0.6945], [0.0714,0.6962], [0.0541,0.6951], [0.0371,0.6940], [0.0198,0.6928],
            [0.9748,0.6513], [0.9571,0.6519], [0.9394,0.6530], [0.9221,0.6519], [0.9061,0.6513], [0.8868,0.6502], [0.8694,0.6519], [0.8534,0.6524], [0.8361,0.6530], [0.8188,0.6530], [0.8011,0.6530], [0.7844,0.6536], [0.7671,0.6524], [0.7484,0.6524], [0.7318,0.6524], [0.7134,0.6524], [0.6954,0.6524], [0.6794,0.6524], [0.6621,0.6519], [0.6451,0.6519], [0.6281,0.6519], [0.6091,0.6524], [0.5931,0.6524], [0.5744,0.6530], [0.5591,0.6530], [0.5401,0.6519], [0.5241,0.6530], [0.5048,0.6530], [0.4878,0.6513], [0.4701,0.6508], [0.4555,0.6513], [0.4355,0.6524], [0.4188,0.6536], [0.4008,0.6530], [0.3841,0.6519], [0.3665,0.6513], [0.3501,0.6524], [0.3331,0.6524], [0.3145,0.6519], [0.2981,0.6519], [0.2798,0.6536], [0.2641,0.6530], [0.2455,0.6524], [0.2285,0.6530], [0.2121,0.6530], [0.1951,0.6524], [0.1765,0.6530], [0.1585,0.6524], [0.1418,0.6519], [0.1241,0.6524], [0.1075,0.6513], [0.0898,0.6519], [0.0711,0.6524], [0.0534,0.6530], [0.0371,0.6519], [0.0181,0.6524],
            [0.9754,0.6099], [0.9581,0.6099], [0.9401,0.6110], [0.9218,0.6105], [0.9048,0.6105], [0.8871,0.6116], [0.8691,0.6105], [0.8541,0.6110], [0.8364,0.6116], [0.8171,0.6116], [0.8011,0.6082], [0.7834,0.6099], [0.7661,0.6105], [0.7488,0.6110], [0.7321,0.6099], [0.7144,0.6110], [0.6954,0.6110], [0.6784,0.6116], [0.6614,0.6099], [0.6444,0.6099], [0.6264,0.6110], [0.6104,0.6110], [0.5908,0.6088], [0.5751,0.6094], [0.5588,0.6099], [0.5391,0.6105], [0.5225,0.6099], [0.5055,0.6105], [0.4875,0.6105], [0.4705,0.6105], [0.4535,0.6110], [0.4355,0.6094], [0.4195,0.6110], [0.4021,0.6105], [0.3828,0.6088], [0.3648,0.6105], [0.3501,0.6110], [0.3335,0.6110], [0.3155,0.6110], [0.2985,0.6105], [0.2811,0.6105], [0.2638,0.6105], [0.2451,0.6110], [0.2275,0.6116], [0.2118,0.6110], [0.1948,0.6105], [0.1754,0.6110], [0.1588,0.6116], [0.1411,0.6105], [0.1248,0.6099], [0.1074,0.6099], [0.0874,0.6094], [0.0714,0.6071], [0.0538,0.6101], [0.0361,0.6106], [0.0194,0.6106],
            [0.9744,0.5667], [0.9564,0.5673], [0.9394,0.5678], [0.9221,0.5678], [0.9051,0.5684], [0.8888,0.5684], [0.8694,0.5684], [0.8524,0.5678], [0.8358,0.5678], [0.8194,0.5684], [0.8008,0.5684], [0.7824,0.5684], [0.7661,0.5690], [0.7494,0.5690], [0.7321,0.5690], [0.7131,0.5684], [0.6961,0.5678], [0.6794,0.5673], [0.6611,0.5673], [0.6448,0.5673], [0.6271,0.5678], [0.6108,0.5684], [0.5924,0.5684], [0.5738,0.5678], [0.5588,0.5684], [0.5398,0.5673], [0.5235,0.5678], [0.5061,0.5678], [0.4895,0.5678], [0.4698,0.5684], [0.4525,0.5678], [0.4371,0.5684], [0.4201,0.5684], [0.4028,0.5673], [0.3838,0.5684], [0.3681,0.5684], [0.3498,0.5678], [0.3308,0.5684], [0.3148,0.5684], [0.2981,0.5684], [0.2811,0.5695], [0.2608,0.5678], [0.2461,0.5673], [0.2281,0.5673], [0.2125,0.5673], [0.1941,0.5667], [0.1768,0.5684], [0.1588,0.5695], [0.1408,0.5695], [0.1238,0.5684], [0.1068,0.5673], [0.0888,0.5673], [0.0708,0.5690], [0.0541,0.5695], [0.0374,0.5695], [0.0204,0.5690],
            [0.9751,0.5248], [0.9574,0.5259], [0.9411,0.5254], [0.9228,0.5259], [0.9048,0.5259], [0.8891,0.5254], [0.8684,0.5270], [0.8531,0.5265], [0.8361,0.5265], [0.8174,0.5265], [0.8014,0.5265], [0.7848,0.5259], [0.7664,0.5276], [0.7484,0.5259], [0.7321,0.5259], [0.7141,0.5276], [0.6958,0.5265], [0.6791,0.5259], [0.6611,0.5265], [0.6441,0.5259], [0.6268,0.5259], [0.6104,0.5265], [0.5931,0.5265], [0.5745,0.5270], [0.5575,0.5254], [0.5395,0.5248], [0.5238,0.5259], [0.5055,0.5259], [0.4891,0.5270], [0.4708,0.5265], [0.4528,0.5259], [0.4371,0.5254], [0.4175,0.5265], [0.4001,0.5265], [0.3858,0.5259], [0.3688,0.5259], [0.3511,0.5259], [0.3325,0.5259], [0.3138,0.5259], [0.2975,0.5265], [0.2811,0.5259], [0.2625,0.5259], [0.2468,0.5259], [0.2278,0.5248], [0.2115,0.5259], [0.1928,0.5259], [0.1761,0.5259], [0.1584,0.5265], [0.1401,0.5259], [0.1224,0.5254], [0.1078,0.5254], [0.0890,0.5273], [0.0710,0.5278], [0.0530,0.5273], [0.0370,0.5251], [0.0200,0.5262],
            [0.9744,0.4851], [0.9574,0.4845], [0.9397,0.4839], [0.9223,0.4857], [0.9053,0.4845], [0.8865,0.4833], [0.8713,0.4821], [0.8510,0.4839], [0.8348,0.4839], [0.8189,0.4863], [0.7986,0.4839], [0.7834,0.4845], [0.7668,0.4857], [0.7491,0.4851], [0.7331,0.4851], [0.7136,0.4845], [0.6970,0.4845], [0.6778,0.4851], [0.6641,0.4851], [0.6453,0.4845], [0.6257,0.4839], [0.6091,0.4851], [0.5939,0.4857], [0.5751,0.4851], [0.5577,0.4851], [0.5393,0.4839], [0.5241,0.4845], [0.5067,0.4851], [0.4901,0.4857], [0.4695,0.4857], [0.4550,0.4857], [0.4362,0.4851], [0.4199,0.4839], [0.4019,0.4845], [0.3827,0.4869], [0.3682,0.4863], [0.3491,0.4851], [0.3328,0.4851], [0.3136,0.4845], [0.2963,0.4839], [0.2803,0.4851], [0.2619,0.4851], [0.2467,0.4851], [0.2293,0.4851], [0.2113,0.4851], [0.1935,0.4857], [0.1751,0.4845], [0.1577,0.4845], [0.1407,0.4845], [0.1260,0.4857], [0.1072,0.4857], [0.0887,0.4845], [0.0725,0.4845], [0.0529,0.4845], [0.0374,0.4851], [0.0204,0.4851],
            [0.9748,0.4435], [0.9574,0.4435], [0.9401,0.4429], [0.9228,0.4435], [0.9048,0.4429], [0.8864,0.4429], [0.8708,0.4424], [0.8518,0.4440], [0.8361,0.4440], [0.8181,0.4429], [0.8028,0.4440], [0.7834,0.4446], [0.7651,0.4435], [0.7494,0.4435], [0.7314,0.4440], [0.7138,0.4440], [0.6971,0.4446], [0.6791,0.4435], [0.6614,0.4435], [0.6448,0.4440], [0.6261,0.4435], [0.6111,0.4440], [0.5921,0.4446], [0.5744,0.4440], [0.5578,0.4451], [0.5394,0.4440], [0.5224,0.4446], [0.5058,0.4435], [0.4888,0.4446], [0.4708,0.4435], [0.4535,0.4440], [0.4375,0.4440], [0.4181,0.4446], [0.4005,0.4446], [0.3845,0.4446], [0.3665,0.4440], [0.3485,0.4440], [0.3338,0.4440], [0.3158,0.4440], [0.2975,0.4451], [0.2798,0.4457], [0.2638,0.4446], [0.2468,0.4440], [0.2278,0.4429], [0.2094,0.4424], [0.1934,0.4424], [0.1761,0.4424], [0.1588,0.4429], [0.1414,0.4429], [0.1248,0.4429], [0.1074,0.4424], [0.0881,0.4429], [0.0707,0.4421], [0.0530,0.4421], [0.0360,0.4427], [0.0197,0.4432],
            [0.9750,0.4020], [0.9580,0.4003], [0.9390,0.4025], [0.9197,0.3998], [0.9044,0.3998], [0.8877,0.3998], [0.8704,0.4003], [0.8524,0.4003], [0.8344,0.4020], [0.8180,0.4014], [0.8027,0.4009], [0.7847,0.4009], [0.7664,0.4009], [0.7500,0.4025], [0.7257,0.4025], [0.7137,0.4016], [0.6961,0.4010], [0.6794,0.4010], [0.6604,0.4022], [0.6424,0.4005], [0.6261,0.4010], [0.6074,0.4005], [0.5924,0.3994], [0.5751,0.4005], [0.5581,0.4010], [0.5391,0.3999], [0.5217,0.4010], [0.5061,0.4005], [0.4881,0.4010], [0.4707,0.4016], [0.4547,0.4016], [0.4344,0.4010], [0.4184,0.4016], [0.4011,0.4022], [0.3847,0.4016], [0.3661,0.4022], [0.3491,0.4022], [0.3311,0.4016], [0.3157,0.4022], [0.2974,0.4010], [0.2811,0.4016], [0.2611,0.4010], [0.2461,0.4010], [0.2284,0.4010], [0.2114,0.4016], [0.1941,0.4005], [0.1751,0.4005], [0.1571,0.4010], [0.1411,0.4005], [0.1224,0.3999], [0.1051,0.4005], [0.0881,0.4010], [0.0724,0.3999], [0.0544,0.4005], [0.0361,0.4005], [0.0197,0.4010],
            [0.9744,0.3605], [0.9571,0.3600], [0.9398,0.3594], [0.9221,0.3589], [0.9054,0.3583], [0.8868,0.3594], [0.8698,0.3605], [0.8534,0.3616], [0.8354,0.3594], [0.8171,0.3605], [0.8004,0.3600], [0.7848,0.3600], [0.7664,0.3594], [0.7501,0.3600], [0.7321,0.3589], [0.7161,0.3578], [0.6968,0.3594], [0.6784,0.3605], [0.6618,0.3605], [0.6454,0.3616], [0.6284,0.3616], [0.6101,0.3611], [0.5921,0.3616], [0.5744,0.3578], [0.5584,0.3572], [0.5418,0.3594], [0.5238,0.3594], [0.5055,0.3600], [0.4895,0.3600], [0.4718,0.3600], [0.4528,0.3600], [0.4361,0.3600], [0.4178,0.3600], [0.4021,0.3600], [0.3838,0.3605], [0.3681,0.3600], [0.3485,0.3600], [0.3331,0.3594], [0.3158,0.3600], [0.2985,0.3589], [0.2808,0.3611], [0.2635,0.3616], [0.2461,0.3611], [0.2288,0.3605], [0.2111,0.3600], [0.1925,0.3589], [0.1758,0.3594], [0.1588,0.3600], [0.1421,0.3600], [0.1231,0.3589], [0.1064,0.3589], [0.0908,0.3594], [0.0718,0.3598], [0.0545,0.3592], [0.0364,0.3578], [0.0197,0.3592],
        ],
    },
    'C-R21_R26.svg': {
        'path': 'C-R21_R26.svg',
        'name': 'Секция C, диски R21-R26',
        'code': 'C-R21_R26',
        'label': 'C',
        'i': 7, # width
        'j': 8, # height
        'direction': 'rtl',
        'color': '#b7a6bd',
        'show': 'false',
        'type': 'wheel',
        'coords': [[0.3927,0.9417], [0.3444,0.9461], [0.3027,0.9482], [0.2571,0.9504], [0.2128,0.9461], [0.1710,0.9417], [0.1293,0.9395], [0.3914,0.8395], [0.3470,0.8395], [0.3014,0.8395], [0.2584,0.8395], [0.2101,0.8352], [0.1723,0.8374], [0.1241,0.8374], [0.3927,0.7352], [0.3444,0.7308], [0.3040,0.7308], [0.2623,0.7308], [0.2141,0.7265], [0.1736,0.7287], [0.1241,0.7308], [0.3901,0.6156], [0.3483,0.6287], [0.3027,0.6221], [0.2597,0.6200], [0.2193,0.6287], [0.1697,0.6308], [0.1306,0.6265], [0.3940,0.5243], [0.3418,0.5156], [0.3027,0.5221], [0.2623,0.5134], [0.2167,0.5134], [0.1710,0.5156], [0.1267,0.5156], [0.3914,0.4091], [0.3470,0.4134], [0.3014,0.4091], [0.2623,0.4091], [0.2128,0.4113], [0.1723,0.4113], [0.1293,0.4113], [0.3927,0.3069], [0.3497,0.3069], [0.3053,0.3047], [0.2584,0.3047], [0.2193,0.3069], [0.1684,0.3134], [0.1280,0.3091], [0.3901,0.2004], [0.3483,0.1982], [0.3053,0.2004], [0.2584,0.1982], [0.2154,0.1982], [0.1671,0.1982], [0.1228,0.2004]],
    },
    'D-R19_R20.svg': {
        'path': 'D-R19_R20.svg',
        'name': 'Секция D, диски R19-R20',
        'code': 'D-R19_R20',
        'label': 'D',
        'i': 19, # width
        'j': 9, # height
        'direction': 'ltr',
        'color': '#b7a6bd',
        'show': 'false',
        'type': 'wheel',
        'coords': [
            [0.8516,0.9482], [0.8112,0.9482], [0.7708,0.9461], [0.7291,0.9461], [0.6899,0.9461], [0.6495,0.9504], [0.6117,0.9482], [0.5713,0.9504], [0.5309,0.9461], [0.4892,0.9461], [0.4500,0.9461], [0.4122,0.9461], [0.3731,0.9482], [0.3301,0.9461], [0.2910,0.9461], [0.2493,0.9439], [0.2062,0.9461], [0.1684,0.9461], [0.1306,0.9439],
            [0.8542,0.8526], [0.8138,0.8547], [0.7747,0.8547], [0.7356,0.8547], [0.6952,0.8526], [0.6547,0.8526], [0.6117,0.8526], [0.5713,0.8526], [0.5322,0.8504], [0.4944,0.8504], [0.4474,0.8526], [0.4096,0.8482], [0.3692,0.8504], [0.3275,0.8482], [0.2897,0.8504], [0.2493,0.8504], [0.2101,0.8526], [0.1697,0.8504], [0.1267,0.8504],
            [0.8516,0.7504], [0.8086,0.7547], [0.7747,0.7547], [0.7330,0.7569], [0.6886,0.7526], [0.6495,0.7526], [0.6130,0.7526], [0.5713,0.7547], [0.5322,0.7526], [0.4879,0.7547], [0.4527,0.7547], [0.4083,0.7504], [0.3718,0.7547], [0.3314,0.7547], [0.2871,0.7547], [0.2545,0.7547], [0.2088,0.7569], [0.1697,0.7547], [0.1319,0.7526],
            [0.8555,0.6613], [0.8151,0.6569], [0.7734,0.6569], [0.7291,0.6613], [0.6899,0.6569], [0.6534,0.6547], [0.6130,0.6591], [0.5700,0.6613], [0.5322,0.6591], [0.4931,0.6591], [0.4513,0.6591], [0.4109,0.6591], [0.3692,0.6569], [0.3288,0.6569], [0.2884,0.6569], [0.2506,0.6547], [0.2075,0.6547], [0.1684,0.6547], [0.1319,0.6547],
            [0.8516,0.5613], [0.8151,0.5591], [0.7760,0.5613], [0.7382,0.5678], [0.6925,0.5634], [0.6534,0.5591], [0.6143,0.5591], [0.5726,0.5613], [0.5348,0.5569], [0.4931,0.5591], [0.4487,0.5591], [0.4148,0.5613], [0.3705,0.5613], [0.3288,0.5591], [0.2884,0.5634], [0.2493,0.5591], [0.2049,0.5569], [0.1697,0.5678], [0.1319,0.5634],
            [0.8529,0.4656], [0.8125,0.4678], [0.7734,0.4656], [0.7330,0.4634], [0.6925,0.4656], [0.6521,0.4613], [0.6117,0.4613], [0.5713,0.4613], [0.5322,0.4656], [0.4905,0.4613], [0.4500,0.4656], [0.4096,0.4678], [0.3718,0.4656], [0.3314,0.4656], [0.2897,0.4634], [0.2480,0.4634], [0.2101,0.4656], [0.1736,0.4656], [0.1267,0.4656],
            [0.8516,0.3678], [0.8138,0.3656], [0.7734,0.3634], [0.7343,0.3700], [0.6939,0.3656], [0.6508,0.3656], [0.6091,0.3656], [0.5752,0.3678], [0.5348,0.3678], [0.4879,0.3700], [0.4527,0.3678], [0.4122,0.3656], [0.3744,0.3656], [0.3288,0.3700], [0.2897,0.3678], [0.2519,0.3656], [0.2101,0.3634], [0.1710,0.3634], [0.1306,0.3634],
            [0.8555,0.2656], [0.8086,0.2678], [0.7747,0.2700], [0.7317,0.2700], [0.6925,0.2721], [0.6508,0.2700], [0.6130,0.2700], [0.5726,0.2700], [0.5309,0.2700], [0.4918,0.2700], [0.4448,0.2721], [0.4122,0.2721], [0.3718,0.2721], [0.3327,0.2721], [0.2897,0.2721], [0.2480,0.2721], [0.2101,0.2743], [0.1710,0.2700], [0.1306,0.2700],
            [0.8550,0.1778], [0.8133,0.1747], [0.7725,0.1762], [0.7355,0.1731], [0.6938,0.1716], [0.6522,0.1716], [0.6105,0.1731], [0.5707,0.1747], [0.5300,0.1747], [0.4920,0.1747], [0.4512,0.1747], [0.4114,0.1731], [0.3698,0.1716], [0.3309,0.1731], [0.2883,0.1747], [0.2512,0.1762], [0.2114,0.1747], [0.1679,0.1762], [0.1272,0.1716],
        ],
    },
    'T-R14_R15.svg': {
        'path': 'T-R14_R15.svg',
        'name': 'Секция T, шины R14-R15',
        'code': 'T-R14_R15',
        'label': 'T',
        'i': 24, # width
        'j': 7, # height
        'direction': 'ltr/rtl',
        'color': '#b7a6bd',
        'show': 'true',
        'type': 'tire',
        'coords': [
            [0.9520,0.8156], [0.9168,0.8243], [0.8842,0.8221], [0.8464,0.8178], [0.8164,0.8178], [0.7786,0.8178], [0.7473,0.8156], [0.7121,0.8156], [0.6782,0.8156], [0.6482,0.8178], [0.6143,0.8200], [0.5765,0.8200], [0.4188,0.8200], [0.3849,0.8200], [0.3483,0.8178], [0.3158,0.8178], [0.2832,0.8178], [0.2467,0.8200], [0.2115,0.8178], [0.1762,0.8178], [0.1410,0.8178], [0.1098,0.8200], [0.0759,0.8200], [0.0459,0.8178],
            [0.9559,0.7265], [0.9207,0.7352], [0.8855,0.7308], [0.8451,0.7352], [0.8164,0.7374], [0.7825,0.7352], [0.7460,0.7352], [0.7147,0.7330], [0.6808,0.7330], [0.6443,0.7352], [0.6117,0.7330], [0.5752,0.7330], [0.4201,0.7395], [0.3822,0.7395], [0.3523,0.7374], [0.3171,0.7352], [0.2819,0.7352], [0.2467,0.7330], [0.2128,0.7330], [0.1789,0.7330], [0.1424,0.7330], [0.1124,0.7352], [0.0719,0.7374], [0.0407,0.7395],
            [0.9533,0.6526], [0.9220,0.6504], [0.8829,0.6504], [0.8490,0.6504], [0.8138,0.6482], [0.7838,0.6504], [0.7486,0.6461], [0.7147,0.6461], [0.6795,0.6482], [0.6391,0.6504], [0.6026,0.6526], [0.5817,0.6504], [0.4214,0.6504], [0.3849,0.6504], [0.3497,0.6504], [0.3158,0.6504], [0.2819,0.6482], [0.2453,0.6482], [0.2115,0.6482], [0.1789,0.6482], [0.1463,0.6504], [0.1098,0.6504], [0.0785,0.6526], [0.0433,0.6526],
            [0.9520,0.5678], [0.9194,0.5678], [0.8855,0.5700], [0.8529,0.5721], [0.8151,0.5678], [0.7812,0.5678], [0.7460,0.5656], [0.7095,0.5656], [0.6743,0.5656], [0.6456,0.5656], [0.6078,0.5656], [0.5778,0.5656], [0.4201,0.5656], [0.3862,0.5678], [0.3510,0.5678], [0.3171,0.5678], [0.2806,0.5700], [0.2493,0.5700], [0.2128,0.5656], [0.1776,0.5656], [0.1450,0.5656], [0.1111,0.5678], [0.0719,0.5700], [0.0433,0.5678],
            [0.9559,0.4830], [0.9155,0.4808], [0.8855,0.4830], [0.8516,0.4830], [0.8151,0.4830], [0.7799,0.4830], [0.7434,0.4830], [0.7095,0.4830], [0.6782,0.4830], [0.6443,0.4830], [0.6078,0.4808], [0.5791,0.4830], [0.4214,0.4808], [0.3862,0.4830], [0.3510,0.4830], [0.3145,0.4808], [0.2792,0.4808], [0.2453,0.4808], [0.2115,0.4852], [0.1789,0.4830], [0.1437,0.4830], [0.1098,0.4830], [0.0733,0.4830], [0.0407,0.4830],
            [0.9546,0.4047], [0.9207,0.4026], [0.8868,0.3982], [0.8503,0.3982], [0.8008,0.3982], [0.7760,0.3939], [0.7460,0.3961], [0.7134,0.3961], [0.6756,0.4004], [0.6430,0.4026], [0.6052,0.4004], [0.5752,0.3982], [0.4201,0.3982], [0.3836,0.4004], [0.3497,0.4026], [0.3158,0.4004], [0.2819,0.4004], [0.2453,0.4004], [0.2141,0.4004], [0.1762,0.3982], [0.1463,0.3982], [0.1124,0.3982], [0.0719,0.3982], [0.0394,0.3982],
            [0.9559,0.3156], [0.9181,0.3134], [0.8855,0.3113], [0.8490,0.3156], [0.8151,0.3156], [0.7851,0.3156], [0.7486,0.3134], [0.7147,0.3134], [0.6795,0.3156], [0.6456,0.3156], [0.6078,0.3156], [0.5752,0.3156], [0.4188,0.3178], [0.3875,0.3178], [0.3523,0.3156], [0.3158,0.3156], [0.2845,0.3134], [0.2493,0.3134], [0.2141,0.3156], [0.1789,0.3178], [0.1424,0.3156], [0.1124,0.3200], [0.0733,0.3156], [0.0407,0.3156],
        ],
    },
}

class Command(BaseCommand):
    def add_arguments(self, parser):
        # Named (optional) arguments
        parser.add_argument('--start',
            action = 'store',
            dest = 'start',
            type = str,
            default = False,
            help = 'Set start date')
        parser.add_argument('--end',
            action = 'store',
            dest = 'end',
            type = str,
            default = False,
            help = 'Set end date')

    def handle(self, *args, **options):
        warehouse = {
            'mapwidth': '1000',
            'mapheight': '600',
            'categories': [],
            'levels': [],
        }
        root_folder = '/home/jocker/django/SITES/vallomcrm/media/warehouse'
        search_sections = ListDir(root_folder, ignore_default_folder=True)
        sections = []
        for item in search_sections:
            fname = os.path.join(root_folder, item)
            if item in svg_files:
                sections.append(svg_files[item])
        for item in sections:
            fname = os.path.join(root_folder, item['path'])
            code = item['code']
            with open(fname, 'r', encoding='utf-8') as f:
                tree = html.fromstring(f.read())
            svg = tree.xpath('//svg')[0]
            first_g = svg.xpath('.//g')[0]
            first_g.attrib['id'] = 'landmarks-%s' % code

            warehouse['categories'].append({
                'id': 'category-%s' % code,
                'title': '%s' % item['name'],
                'color': item['color'],
                'show': item['show'],
                'label': item['label'],
                'i': item['i'],
                'j': item['j'],
            })
            floor_code = 'floor-%s' % code
            floor = {
                'id': floor_code,
                'title': item['name'],
                'map': '/media/warehouse/%s.svg' % code,
                'minimap': '/media/warehouse/%s.jpg' % code,
                'locations': [],
            }
            cur_floor = None
            for level in warehouse['levels']:
                if level['id'] == floor_code:
                    cur_floor = level

            if not cur_floor:
                cur_floor = floor
                warehouse['levels'].append(floor)

            # Тут надо обойти все элементы в файле
            # Берем path, затем должен идти g с foreignObject и текстом
            i = j = 1
            k = 0
            prev_el = None
            for z, el in enumerate(first_g):
                if not len(el) or not prev_el.tag.lower() == 'path' or not el.tag.lower() == 'g':
                    prev_el = el
                    continue

                if i > item['i']:
                    i = 1
                    j += 1
                if not el[0].tag.lower() == 'switch':
                    continue
                if not el[0][0].tag.lower() == 'foreignobject':
                    continue
                if not el[0][1].tag.lower() == 'text':
                    continue
                if not el[0][1].text.isdigit():
                    continue

                el_id = '%s-%s-%s' % (code, j, i)
                label = '%s-%s-%s' % (item['label'], j, i)
                if item['direction'] == 'ltr':
                    el_id = '%s-%s-%s' % (code, j, item['i'] - i + 1)
                    label = '%s-%s-%s' % (item['label'], j, item['i'] - i + 1)
                elif item['direction'] == 'ltr/rtl':
                    if i <= item['i'] / 2:
                        el_id = '%s-%s-%s' % (code, j, item['i'] - i + 1)
                        label = '%s-%s-%s' % (item['label'], j, item['i'] - i + 1)
                    else:
                        el_id = '%s-%s-%s' % (code, j, i - int(item['i']/2))
                        label = '%s-%s-%s' % (item['label'], j, i - int(item['i']/2))

                first_g[z-4].attrib['id'] = el_id
                cur_floor['locations'].append({
                    'id': el_id,
                    'title': label,
                    'about': 'вместимость 4',
                    'description': '%s вместимость 4' % label,
                    'category': 'category-%s' % code,
                    'thumbnail': '/media/warehouse/img/%s.jpg' % item['type'],
                    # Без координат будет глючить перемещение по карте
                    'x': item['coords'][k][0] if item['coords'] else 0,
                    'y': item['coords'][k][1] if item['coords'] else 0,
                })

                i += 1
                k += 1
                prev_el = el

            # Если нужно потестить не затирая
            #with open(fname.replace('.svg', '-2.svg'), 'w+') as f:
            with open(fname, 'w+') as f:
                bstr = etree.tostring(tree, pretty_print=True, encoding='utf-8')
                result = bstr.decode('utf-8')
                result = result.replace('viewbox', 'viewBox')
                result = result.replace('foreignobject', 'foreignObject')
                f.write(result)

        fname = os.path.join(root_folder, 'warehouse.json')
        with open(fname, 'w+', encoding='utf-8') as f:
            f.write(json_pretty_print(warehouse))

