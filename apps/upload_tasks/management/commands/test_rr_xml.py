#-*- coding:utf-8 -*-
import logging

import xml.sax

from django.core.management.base import BaseCommand
from django.conf import settings

logger = logging.getLogger(__name__)

class RRHandler(xml.sax.ContentHandler):
    def __init__(self):
        self.isOffers = False
        self.isOffer = False
        self.ids = []

    def startElement(self, tag, attributes):
        if self.isOffers:
            if tag == 'offer':
                self.isOffer = True
                self.ids.append(attributes.get('id'))
        elif tag == 'offers':
            self.isOffers = True

    def endElement(self, tag):
        if tag == 'offer':
            self.isOffer = False
        elif tag == 'offers':
            self.isOffers = False

    def characters(self, content):
        pass
bad_products = ['151643', '405068', '121074', '133767', '128005', '392764', '260287', '427098', '184108', '421089', '127953', '350255', '130211', '410549', '154146', '74305', '185265', '11588', '114655', '200889', '176591', '392760', '113166', '72901', '247623', '113423', '431769', '70660', '268083', '116435', '57238', '132249', '306034', '124416', '185362', '260372', '437536', '99902', '456341', '113065', '126017', '306063', '113014', '153972', '316668', '124349', '129134', '260290', '273040', '55081', '177104', '184056', '108216', '438504', '31177', '313642', '192351', '368093', '112947', '244673', '175863', '260377', '9292', '83797', '104911', '35875', '260387', '417622', '14124', '7900', '103831', '48728', '372991', '54548', '273479', '440269', '424080', '150014', '42173', '313635', '390814', '325735', '424067', '436683', '132574', '16569', '119505', '367106', '91586', '150526', '32815', '73105', '128962', '200731', '128948', '382260', '313462', '128961', '132590', '451011', '113036', '154902', '82133', '25991', '459974', '131906', '180936', '124215', '176101', '47065', '68536', '217571', '441488', '9933', '306127', '95456', '412687', '19260', '80297', '137023', '40977', '128958', '305527', '441680', '175874', '177529', '172572', '69989', '55157', '341069', '132642', '335067', '50226', '105302', '228942', '124371', '121256', '126861', '214573', '127499', '139055', '171024', '424192', '117638', '415505', '415503', '306138', '73696', '253667', '431969', '313683', '155251', '177440', '236532', '360847', '440439', '60035', '413479', '306059', '124490', '424338', '442968', '217591', '222493', '124013', '443010', '438818', '393168', '205392', '144226', '256124', '441607', '437529', '133529', '145529', '34424', '5676', '319162', '429283', '418530', '63775', '136861', '382249', '328033', '131813', '79133', '169203', '130209', '313428', '175857', '233712', '413483', '113159', '439596', '174675', '115033', '150123', '51140', '86629', '116986', '184190', '325225', '139730', '41845', '113200', '239326', '450591', '446159', '108237', '221855', '39925', '113268', '244667', '315146', '381944', '246108', '54553', '442960', '133915', '160477', '151599', '134177', '150139', '43675', '11423', '192165', '312915', '417332', '454336', '364463', '443957', '97708', '118557', '55030', '130120', '424327', '367104', '154005', '446141', '260306', '127284', '175129', '437331', '381792', '350217', '233736', '144168', '116722', '18525', '274496', '111947', '153856', '409340', '185290', '456242', '127321', '1534', '407111', '233719', '38136', '247613', '218020', '306068', '53799', '133008', '133347', '175978', '128884', '124023', '41978', '19054', '80918', '172159', '11443', '37104', '130984', '138716', '161056', '260291', '153982', '187141', '364476', '142198', '63962', '184335', '325189', '142199', '222585', '185363', '379279', '131710', '152904', '130349', '314254', '442995', '131708', '441478', '51307', '350899', '125703', '313630', '59579', '66760', '204494', '307877', '228883', '144124', '144113', '376967', '95632', '313668', '362205', '412754', '192139', '176447', '9614', '8645', '126683', '187146', '167236', '103737', '382399', '73413', '57574', '424269', '321431', '424106', '180864', '450594', '154120', '113316', '124151', '123986', '108174', '44508', '424299', '415390', '316672', '438442', '7654', '433528', '443308', '176877', '150525', '140412', '133133', '54907', '174869', '416917', '439367', '313597', '435548', '104305', '66172', '445489', '132875', '424151', '138715', '15348', '449345', '217972', '438900', '240093', '437601', '136788', '237489', '174887', '126884', '3019', '185357', '380465', '176494', '125862', '154124', '177106', '71484', '170510', '124157', '453252', '435772', '84970', '104947', '204762', '246374', '364480', '143265', '313627', '424363', '176781', '228922', '165621', '325786', '139033', '135067', '424217', '84681', '367999', '103363', '439375', '141396', '358599', '240086', '143923', '9748', '382139', '174749', '382354', '319142', '455297', '218036', '3340', '218002', '162562', '137089', '231476', '132308', '121895', '54227', '143941', '151729', '121164', '435794', '153948', '44182', '326149', '175096', '14780', '34746', '337349', '51845', '454321', '456768', '66773', '67223', '143293', '453247', '380536', '139056', '184215', '138711', '40130', '439480', '176500', '70778', '67224', '64006', '47569', '128291', '113749', '139626', '241341', '121101', '168615', '424056', '105167', '95416', '443012', '75744', '58033', '212274', '441613', '44673', '77686', '114958', '113165', '168401', '441200', '335060', '243964', '16766', '204732', '8662', '108151', '320701', '142608', '135301', '165684', '240092', '436947', '247297', '142711', '312794', '103851', '450621', '128338', '124426', '137193', '83504', '128918', '108195', '62734', '459558', '19146', '124230', '262086', '313680', '322518', '247628', '247627', '153848', '130804', '448806', '153995', '160472', '97684', '217773', '418894', '10883', '133385', '177064', '176803', '2605', '433679', '57199', '54090', '205320', '193959', '33171', '108172', '203661', '154062', '322321', '431702', '130891', '114999', '42014', '38240', '130890', '180950', '113198', '48312', '39476', '128074', '108873', '108152', '382751', '113433', '184927', '130648', '424294', '176870', '134492', '57819', '136854', '241895', '140608', '130482', '135676', '71102', '99505', '124431', '433682', '133945', '184065', '2796', '440762', '3359', '31523', '167405', '5006', '313021', '123954', '65528', '102507', '11005', '424143', '133730', '133343', '150865', '138162', '176715', '189292', '142606', '156979', '5558', '237886', '176368', '456621', '108234', '128921', '175895', '139697', '445906', '313629', '112965', '306102', '176579', '142917', '382587', '382029', '52179', '45617', '281261', '177101', '52099', '140767', '139159', '187057', '143940', '421021', '57177', '325175', '167672', '176486', '113733', '187374', '433681', '177311', '165422', '177284', '32012', '113434', '113435', '410986', '313656', '221822', '113425', '410987', '148851', '61469', '456569', '142908', '240002', '186923', '123859', '126536', '217581', '185250', '320530', '150103', '97497', '174637', '319150', '154208', '358614', '166512', '108202', '133023', '154497', '2810', '154028', '178826', '442950', '133010', '177119', '138795', '233443', '177312', '38598', '177250', '405016', '241335', '131086', '153968', '131085', '132263', '119622', '101527', '274501', '149481', '183894', '174692', '69438', '177382', '100648', '160471', '96498', '242196', '305533', '184062', '455336', '174816', '174708', '177548', '113151', '68036', '53421', '108429', '148249', '125248', '113296', '124163', '430123', '238819', '443291', '184192', '262039', '134179', '192393', '184282', '358620', '450618', '171001', '45209', '111050', '37674', '154093', '233776', '216238', '319202', '187114', '112916', '111435', '184561', '233778', '433624', '152976', '154139', '435681', '44187', '414992', '125710', '321358', '1980', '320841', '177079', '176630', '253663', '34184', '247610', '143958', '72649', '177080', '382578', '181807', '111194', '216266', '142585', '115849', '252998', '112942', '441475', '95554', '235440', '130863', '123736', '174840', '274459', '412722', '75577', '52239', '176451', '64741', '423163', '149486', '242684', '138934', '412724', '133349', '455316', '50465', '40696', '154078', '253668', '176905', '184194', '382448', '247079', '326405', '177774', '80669', '176308', '5282', '131001', '210869', '151639', '452400', '444157', '306148', '440214', '154001', '424251', '262076', '26946', '160787', '97192', '323470', '233695', '453848', '76293', '326350', '436913', '441481', '216459', '244810', '132640', '112977', '413327', '423148', '153732', '86832', '443437', '216263', '166366', '359526', '382156', '412598', '128977', '73111', '175883', '138942', '136585', '444249', '423545', '3349', '253688', '128333', '149460', '154126', '289709', '124217', '439564', '114734', '174651', '216422', '51309', '247600', '430675', '204547', '260350', '320806', '326484', '424419', '171890', '319172', '172593', '174722', '355240', '130867', '125579', '233039', '316645', '130634', '125255', '350952', '222581', '438469', '319147', '313613', '240072', '284198', '97127', '143865', '313594', '382282', '439754', '435701', '443353', '177131', '214188', '424115', '319138', '201943', '221834', '382763', '38245', '265894', '233799', '460397', '454323', '149943', '152941', '217569', '440198', '115318', '253660', '382167', '241327', '176503', '124161', '212994', '168415', '104229', '440192', '48616', '143944', '229054', '222502', '147411', '319187', '229069', '260351', '382120', '454334', '260366', '59378', '53491', '150722', '319166', '240089', '169196', '313444', '313670', '130925', '18702', '436264', '222586', '441483', '192926', '108142', '424336', '447437', '174648', '335509', '174734', '205372', '204651', '439397', '316581', '128925', '86672', '433589', '62432', '441125', '10648', '176419', '216271', '440226', '174821', '313384', '336326', '184304', '365277', '247303', '326598', '440426', '442966', '350935', '454335', '216262', '440143', '360845', '177455', '444174', '26847', '186243', '202614', '229041', '138776', '313355', '320844', '136970', '130933', '453775', '262090', '44682', '105575', '154134', '132581', '431812', '32017', '244012', '364469', '374047', '177447', '450593', '147644', '441116', '169195', '80981', '133969', '342634', '210839', '133943', '176916', '48358', '447277', '262067', '166792', '174686', '313622', '368064', '143292', '444538', '134848', '441317', '313664', '174650', '174779', '355372', '237195', '421133', '124156', '132473', '435428', '110192', '133063', '133314', '306050', '454322', '125257', '109058', '67418', '450620', '184307', '382154', '154115', '63567', '58823', '60409', '382236', '132448', '435149', '438825', '150128', '37201', '423344', '128950', '424129', '439572', '132449', '132451', '244794', '410735', '410750', '443289', '246367', '56949', '241329', '382133', '456403', '237232', '253681', '88645', '360846', '439586', '229252', '36968', '138541', '45941', '132552', '253141', '443750', '152938', '130812', '244813', '134324', '229250', '114730', '150523', '237753', '132582', '177240', '441064', '244476', '152779', '246368', '176182', '442915', '142472', '66812', '456492', '440358', '128522', '133316', '122042', '174732', '437306', '306079', '128942', '381779', '87735', '118207', '138948', '444136', '325302', '93592', '180859', '281257', '134967', '229019', '440690', '444207', '127894', '222591', '193063', '170971', '69806', '355370', '438497', '233614', '193120', '152962', '139157', '135751', '398991', '262071', '147903', '3661', '153930', '16045', '43464', '105311', '176802', '443006', '92830', '313663', '174769', '113034', '367111', '281253', '41601', '390816', '16367', '42368', '441482', '114762', '203388', '444242', '456355', '423347', '66772', '274479', '133321', '437487', '233632', '442252', '449259', '1858', '121303', '247617', '312930', '172565', '437483', '133011', '18759', '260349', '176133', '274465', '160484', '262073', '177313', '125898', '61903', '171713', '416858', '111529', '127169', '150125', '289807', '237889', '128927', '153998', '445518', '325742', '174817', '326472', '125594', '4460', '67051', '52548', '82336', '147658', '176690', '152973', '441383', '144116', '415946', '245577', '184249', '124481', '424068', '443749', '129150', '441114', '93277', '11460', '60745', '174827', '176609', '229059', '414979', '138943', '124432', '142863', '382963', '69959', '441615', '67013', '142605', '306045', '128892', '128345', '262072', '28839', '81536', '216455', '61292', '403504', '247622', '409190', '244658', '108712', '133029', '76135', '444146', '171711', '255733', '176756', '456618', '204541', '247082', '204495', '130218', '176147', '174856', '65170', '321473', '305476', '71101', '11427', '148914', '437504', '124027', '82564', '443307', '233605', '37074', '130957', '152789', '416966', '139126', '319186', '442654', '154676', '144613', '135091', '423297', '121989', '440692', '456770', '440693', '437489', '455034', '440128', '441068', '133968', '153593', '423203', '442935', '176376', '142607', '424118', '424341', '437313', '325206', '132559', '312083', '221853', '260355', '80604', '139007', '175926', '152125', '424126', '424228', '360848', '456401', '361577', '121306', '262043', '130410', '413797', '372995', '50591', '306066', '142580', '66051', '273050', '424098', '439977', '71897', '232285', '184221', '247072', '165751', '305489', '440433', '128916', '174654', '169198', '350927', '177483', '124477', '247075', '176096', '313358', '177484', '66771', '261963', '152835', '52374', '174704', '113163', '414968', '244056', '325785', '336335', '193489', '440763', '444156', '108150', '441067', '174799', '367132', '133062', '176099', '129657', '108158', '239725', '439485', '233706', '142911', '233704', '415357', '177125', '391695', '284229', '139059', '112294', '6187', '424162', '350913', '3046', '130868', '414948', '122939', '436883', '130928', '240079', '238823', '56222', '439386', '128914', '175955', '322523', '312774', '453253', '444221', '130201', '176323', '415348', '437320', '398981', '437861', '439760', '430683', '175132', '128887', '382251', '247312', '444237', '128085', '213224', '200711', '139127', '187143', '240126', '247067', '253685', '447014', '128520', '419514', '175940', '61053', '446158', '237406', '120553', '205574', '456182', '453248', '213223', '314258', '418942', '420540', '71894', '222503', '56237', '456491', '456490', '421016', '418525', '130811', '127726', '455736', '456489', '446964', '133135', '177432', '140411', '289808', '453743', '38046', '253002', '151787', '51389', '76276', '127591', '442990', '124892', '350244', '446131', '350243', '174669', '382681', '262055', '71485', '416881', '174826', '142913', '355369', '167053', '132478', '436835', '124171', '445400', '139630', '133317', '112925', '3623', '319161', '438897', '64364', '124032', '150052', '72026', '407113', '244816', '319175', '48575', '174642', '64357', '107468', '456616', '124461', '171707', '449246', '184342', '158753', '6488', '177567', '64386', '424372', '424195', '444391', '361543', '176262', '169143', '209332', '176473', '17801', '11822', '114748', '61116', '133041', '174850', '150101', '17875', '182424', '252991', '319200', '319167', '253683', '236750', '138997', '252990', '306131', '187034', '147704', '382520', '256105', '364960', '152775', '51308', '50605', '72445', '341153', '305510', '55624', '128636', '184305', '48647', '177149', '147652', '450327', '424405', '313432', '155006', '184566', '443286', '424300', '407112', '436519', '424279', '446130', '436239', '312787', '314122', '424689', '18928', '313429', '177471', '155005', '367107', '236983', '142583', '165669', '69458', '450589', '151627', '61522', '441484', '444196', '246364', '19', '43203', '125583', '419511', '321357', '434651', '133348', '107400', '262040', '174681', '203095', '111644', '113146', '444142', '142566', '177179', '435565', '147300', '83538', '169194', '325828', '440162', '365299', '204746', '134178', '85145', '325340', '128920', '70223', '6056', '15265', '260337', '260381', '350229', '424031', '138320', '1711', '260308', '187116', '105571', '423537', '64187', '157371', '71104', '177345', '114754', '113290', '112320', '187118', '118131', '3029', '341076', '105560', '57107', '40107', '137144', '411980', '132578', '124225', '423535', '313605', '83593', '3997', '138951', '70037', '177213', '424402', '35151', '41492', '38378', '439815', '58965', '319735', '238786', '142778', '337352', '138952', '143257', '112926', '176007', '115501', '146826', '117510', '174891', '192450', '118789', '153850', '127494', '64943', '247318', '443293', '154006', '124921', '443310', '60989', '259666', '129171', '66774', '440215', '127279', '415499', '153907', '438275', '450815', '152657', '177358', '22827', '162563', '358639', '124179', '113209', '101853', '439390', '152963', '127305', '152807', '133320', '112991', '381771', '176006', '56299', '186281', '437117', '313661', '124034', '265891', '21168', '325201', '152818', '152866', '128545', '171701', '424069', '153853', '362201', '133916', '113772', '128898', '110058', '319631', '138718', '382630', '438470', '133056', '108160', '137201', '38244', '246366', '326355', '420700', '182329', '70511', '172162', '132585', '133030', '350252', '153915', '170514', '81659', '41344', '10825', '134175', '103213', '314889', '335042', '312965', '171002', '150079', '414977', '153959', '139140', '6497', '174639', '93261', '100885', '176013', '113249', '335013', '174762', '204757', '169242', '174892', '319189', '242199', '132568', '184315', '71892', '252957', '325204', '132536', '61113', '19085', '43405', '139070', '364349', '113300', '73477', '176211', '175851', '152924', '37331', '424344', '228920', '2696', '367112', '413481', '204503', '246392', '192428', '241996', '115450', '100901', '326394', '138300', '67705', '233688', '442945', '175944', '320537', '446977', '192083', '231312', '167018', '184263', '37673', '32332', '95811', '137636', '71868', '3738', '435376', '67057', '56185', '128951', '72490', '62218', '450608', '43516', '140944', '118576', '59437', '410094', '325217', '237228', '135186', '319865', '456398', '136961', '84805', '148102', '53921', '444254', '188133', '130930', '128289', '439755', '444144', '59010', '142476', '128023', '54696', '177437', '133973', '50767', '217553', '2600', '61528', '180956', '133340', '218001', '113293', '320536', '6018', '322524', '128342', '325260', '145586', '438909', '152816', '38284', '128945', '133773', '63284', '54680', '177178', '228919', '321424', '365295', '136846', '239796', '72399', '161309', '68758', '350245', '244474', '114745', '336339', '440164', '114755', '11046', '379285', '127461', '176697', '55807', '117979', '54253', '228914', '262044', '175972', '335033', '200687', '228916', '273039', '233781', '113776', '144098', '212969', '105530', '177551', '152927', '142604', '176774', '187111', '174649', '184235', '101632', '74339', '424207', '107401', '437530', '452880', '62897', '412589', '127921', '260289', '71741', '130864', '364371', '175112', '237658', '55129', '424316', '176654', '424070', '228925', '182414', '72002', '176779', '438649', '166511', '247611', '101128', '438496', '439379', '222510', '130926', '72406', '144537', '170987', '437016', '320869', '181805', '217592', '435372', '421281', '108163', '93347', '218027', '366743', '439403', '124146', '117795', '233596', '71019', '113009', '252992', '1273', '53617', '186273', '174703', '242936', '456568', '28528', '170958', '193474', '205317', '89531', '39201', '335986', '217993', '441531', '111538', '145580', '319128', '242966', '146538', '146539', '71521', '424204', '424093', '413834', '174752', '174624', '451333', '176095', '454200', '260284', '69065', '320529', '32477', '440191', '182416', '326387', '306098', '421018', '21429', '228937', '11060', '443320', '216255', '104207', '9931', '247074', '38280', '244832', '152961', '247073', '442918', '60298', '50040', '221857', '440334', '229891', '307868', '326347', '382159', '335725', '379275', '165864', '229247', '144614', '9741', '177038', '260302', '326385', '124221', '433572', '424079', '133344', '443317', '105389', '82631', '447199', '174663', '176581', '319211', '174775', '412756', '109632', '19706', '174627', '93520', '101398', '444565', '38854', '154025', '13017', '174802', '165837', '412716', '326357', '237386', '244818', '233617', '142897', '171070', '319146', '436834', '108124', '438834', '125707', '152833', '67304', '67281', '336341', '341061']

class Command(BaseCommand):
    def add_arguments(self, parser):
        # Named (optional) arguments
        parser.add_argument('--start',
            action = 'store',
            dest = 'start',
            type = str,
            default = False,
            help = 'Set start date')
        parser.add_argument('--end',
            action = 'store',
            dest = 'end',
            type = str,
            default = False,
            help = 'Set end date')

    def handle(self, *args, **options):
        parser = xml.sax.make_parser()
        rr_handler = RRHandler()
        parser.setContentHandler(rr_handler)
        parser.parse('/home/jocker/Downloads/rr__rr_xml.yml')

        absent = []
        for item in bad_products:
            if not item in rr_handler.ids:
                absent.append(item)

        print(absent)
        print('len absent', len(absent), 'len in feed', len(rr_handler.ids))
