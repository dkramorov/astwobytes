apt install swapspace

Проверить /etc/fstab
findmnt --verify --verbose

root@295753-cc69233:~# free -h
              total        used        free      shared  buff/cache   available
Mem:           985M        432M        182M        4.0M        370M        407M
Swap:          1.0G          0B        1.0G

# ----------------------------
# Добавление swap в /etc/fstab
# ----------------------------
root@295753-cc69233:~# cat /etc/fstab
# <file system> <mount point>   <type>  <options>       <dump>  <pass>
# / was on /dev/vda1 during installation
/dev/vda1 /               ext4    barrier=0 0       1
/swapfile swap            swap    defaults  0       0

Как создать и включить swap в Linux

1. В этом примере мы создадим файл подкачки размером 2 ГБ, используя команду dd, как показано ниже. Обратите внимание, что bs = 1M означает чтение и запись до 1 Мбайт за раз, а count = (1 x 2048)MB.

# dd if =/dev/zero of =/swapfile bs=1M count=2048


В качестве альтернативы используйте команду fallocate следующим образом:

# fallocate --length 2GiB /swapfile


А затем установите соответствующие разрешения для файла. Сделайте его доступным только для пользователей root следующим образом:

# chmod 600 /swapfile


2. Теперь настройте файл для пространства подкачки с помощью команды mkwap.

# mkswap /swapfile


3. Затем включите файл подкачки и добавьте его в систему.

# swapon /swapfile


4. После этого включите файл подкачки, который будет установлен во время загрузки. Отредактируйте файл /etc/fstab и добавьте в него следующую строку:

/swapfile     swap     swap     defaults     0     0


В приведенной выше строке каждое поле означает:

    /swapfile — имя устройства/файла
    swap — определяет точку подключения устройства
    swap — указывает тип файловой системы
    defaults — описывает параметры установки
    0 — указывает параметр, который будет использоваться программой сброса
    0 — указывает параметр команды fsck

6. Чтобы установить, как часто файл подкачки может использоваться ядром, откройте файл /etc/sysctl.conf и добавьте следующие параметры.

vm.swappiness = 10
vfs_cache_pressure = 50


vm.swappiness — влияет на процесс переноса данных в swap при недостатке физической памяти. Большие значения приводят к более активному использованию swap-файла, меньшие по факту не сильно уменьшают использование swap-файла но чуть затягивают процесс перемещения данных в swap (т.е. перенос в swap ядро просто пытается отложить на потом). Значение по умолчанию 60, рекомендуется установить 10.

vm.vfs_cache_pressure — влияет на то на сколько агрессивно ядро забирает блоки из кеша, который используется для буферизации данных о каталогах и i-node-ов. Это только один из типов кешей, которые ядро использует при работе с диском. А кроме того чем больше значение тем более агрессивно ядро будет забирать страницы из этого кеша.

7. Теперь проверьте, чтобы файл подкачки был создан с помощью команды swapon.

# swapon -s
OR
# free
OR
# cat /proc/swaps

